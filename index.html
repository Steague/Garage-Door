<!doctype html>
<html>
<head>
	<title> Teague Garage </title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">

	<!-- Home screen icon  Mathias Bynens mathiasbynens.be/notes/touch-icons -->
	<!-- For iPhone 4 with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon.png">
	<!-- For first-generation iPad: -->
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon.png">
	<!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
	<link rel="apple-touch-icon-precomposed" href="apple-touch-icon-precomposed.png">
	<!-- For nokia devices and desktop browsers : -->
	<link rel="shortcut icon" href="favicon.ico" />

	<!-- Mobile IE allows us to activate ClearType technology for smoothing fonts for easy reading -->
	<meta http-equiv="cleartype" content="on">

	<!-- jQuery Mobile CSS bits -->
	<link rel="stylesheet" href="css/jquery.mobile-1.4.0.min.css" />

	<!-- Custom css -->
	<link rel="stylesheet" href="css/custom.css" />

	<!-- Javascript includes -->
	<script type="text/javascript" src="js/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="/webiopi.js"></script>
	<script type="text/javascript" src="js/mobileinit.js"></script>
	<script type="text/javascript" src="js/ios-orientationchange-fix.min.js"></script>
	<script type="text/javascript" src="js/jquery.mobile-1.4.0.js"></script>
	<script type="text/javascript" src="js/application.js"></script>
	<!-- Startup Images for iDevices -->
	<script>(function(){var a;if(navigator.platform==="iPad"){a=window.orientation!==90||window.orientation===-90?"images/startup-tablet-landscape.png":"images/startup-tablet-portrait.png"}else{a=window.devicePixelRatio===2?"images/startup-retina.png":"images/startup.png"}document.write('<link rel="apple-touch-startup-image" href="'+a+'"/>')})()</script>
	<!-- The script prevents links from opening in mobile safari. https://gist.github.com/1042026 -->
	<script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script>
	<script type="text/javascript">
		$(document).ready(function() {
	        //webiopi().ready(function() {
	        	console.log("foo");
				var content, content2, button;
				content = $("#content");
				content2 = $("#openCloseButton");
				$(checkStatus);
				webiopi().setFunction(7,"in");
				webiopi().setFunction(18,"in");
			
			
	            // create an "OPEN" labeled button for GPIO 18
	            button = webiopi().createGPIOButton(18, "");
	            content2.append(button); // append button to content div

	            // create button that calls the mousedown function below
	            button = webiopi().createButton("button", "GARAGE DOOR", showConfirm );
	            content.append(button); // append button to content div
				
				function checkStatus() {
				if ($('#gpio18').hasClass('LOW')){
					$("#gpio18").html('CLOSED');
					}else {
						$("#gpio18").html('OPEN');
					}
				setTimeout(checkStatus,1000)
				}

				// this function gets called by the mousedown function below - it sets gpio7 back to 'IN'
				function mouseup() {
					webiopi().setFunction(7,"in");
					//window.alert("RELAY OPEN");
				}

				// this function sets gpio7 to 'OUT' which will trip the relay.  After .5 second it calls mouseup above.
				// hides the confirmation div and makes doge face change
				function mousedown() {
					document.getElementById('button').style.background = "#808080 url('/doge-action.png') no-repeat center bottom";
					webiopi().setFunction(7,"out");
					//window.alert("RELAY CLOSED");
					document.getElementById('confirmBox').style.visibility = "hidden";
					document.getElementById('confirmText').style.visibility = "hidden";
					setTimeout(mouseup, 500);
					setTimeout(dogeNormal, 3000);
				}

				// after pressing no hide the confirmation div
				function hideConfirm() {
					document.getElementById('confirmBox').style.visibility = "hidden";
					document.getElementById('confirmText').style.visibility = "hidden";
				}

				// show confirmation div after pressing garage door button
				function showConfirm() {
					document.getElementById('yes').onclick = mousedown;
					document.getElementById('no').onclick = hideConfirm;
					document.getElementById('confirmBox').style.visibility = "visible";
					document.getElementById('confirmText').style.visibility = "visible";
				}
				
				// change doge face to normal
				function dogeNormal() {
					document.getElementById('button').style.background = "#808080 url('/doge-static.png') no-repeat center bottom";
				}

	        // constantly refresh status to see if door is open or closed
				//webiopi().refreshGPIO(true)
			//});
		});

    </script>
</head>
<body>
	<div data-role="page">

		<div data-role="header">
			<h1>Teague Garage</h1>
		</div>

		<div data-role="content">

<!-- 			<ul data-role="listview" data-inset="true" data-theme="c" data-dividertheme="b">
				<li>Snippet Pages</li>
				<li><a href="buttons.html">Buttons</a></li>
				<li><a href="grids.html">Grids</a></li>
				<li><a href="collapsibles.html">Collapsible Boxes</a></li>
				<li><a href="collapsible-sets.html">Collapsible Sets</a></li>
				<li><a href="forms.html">Form Elements</a></li>
				<li><a href="lists.html">List Views</a></li>
			</ul> -->

			<h3 class="ui-bar ui-bar-a ui-corner-all">Door Status</h3>
			<div id="openCloseButton" style="margin-left: auto; margin-right: auto; position:relative"></div>
			<!-- <div id="openCloseButton" href="#" data-iconpos="top" data-icon="home" class="ui-link ui-btn ui-icon-home ui-btn-icon-top ui-shadow ui-corner-all" role="button">Garage Door</div> -->
			<div id="content" style="margin-left: auto; margin-right: auto; position:relative"></div>
			<div id="confirmText"><h2>Are you sure?</h2></div>
			<div id="confirmBox"><div id="yes" class="confirmButton">YES</div><div id="no" class="confirmButton">NO</div></div>

		</div>

		<div data-role="footer">
			<p>&copy; 2015 - Teague Garage</p>
		</div>

	</div>
</body>
</html>